<ng-container [formGroup]="form">
  <table #dataTable="matTable"
         mat-table [dataSource]="datasource.controls"
         class="table--base mat-elevation-z1"
         [formArrayName]="arrayFieldName">
    <!-- Value Definition -->
    <ng-container matColumnDef="value">
      <th mat-header-cell *matHeaderCellDef>{{fieldTitle}}s</th>
      <td mat-cell *matCellDef="let control; let i = index">
        <ng-container *ngIf="i === 0; else otherIndices">
          <ddaplib-form-field-btn-group [control]="control"
                                        [fieldTitle]="fieldTitle"
                                        [fieldName]="arrayFieldName"
                                        [showAutocomplete]="showAutocomplete"
                                        [autocompleteOptions]="autocompleteOptions"
                                        (doneButtonClicked)="addEmptyRow()">
          </ddaplib-form-field-btn-group>
        </ng-container>
        <ng-template #otherIndices>
          <ng-container *ngIf="currentlyEditing === i; else readonlyMode">
            <ddaplib-form-field-btn-group [control]="control"
                                          [fieldName]="arrayFieldName"
                                          [index]="i"
                                          [showAutocomplete]="showAutocomplete"
                                          [autocompleteOptions]="autocompleteOptions"
                                          (doneButtonClicked)="addEmptyRow()">
            </ddaplib-form-field-btn-group>
          </ng-container>
        </ng-template>
        <ng-template #readonlyMode>
          <a [href]="control.value"
             target="_blank"
             rel="noopener noreferrer">
            {{ control.value }}
          </a>
        </ng-template>
      </td>
    </ng-container>
    <!-- More Actions Column -->
    <ng-container matColumnDef="moreActions" stickyEnd>
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let control; let i = index"
          class="table--actions">
        <mat-icon *ngIf="i !== 0"
                  [matMenuTriggerFor]="moreActionsMenu"
                  [matMenuTriggerData]="{ index: i }"
                  data-se="btn-more-actions">
          more_vert
        </mat-icon>
      </td>
    </ng-container>

    <mat-menu #moreActionsMenu="matMenu">
      <ng-template matMenuContent
                   let-index="index">
        <button mat-menu-item
                data-se="btn-edit"
                (click)="currentlyEditing = index">
          Edit
        </button>
        <button mat-menu-item
                class="color--warn"
                data-se="btn-remove"
                (click)="removeRow(index)">
          Remove
        </button>
      </ng-template>
    </mat-menu>

    <!-- Header and Row Declarations -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</ng-container>
